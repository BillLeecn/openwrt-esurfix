<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="OpenWRT-eSurfix : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>OpenWRT-eSurfix</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/BillLeecn/openwrt-esurfix">View on GitHub</a>

          <h1 id="project_title">OpenWRT-eSurfix</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/BillLeecn/openwrt-esurfix/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/BillLeecn/openwrt-esurfix/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a name="%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C"><span class="octicon octicon-link"></span></a>使用手册</h2>

<h3>
<a name="prerequisites" class="anchor" href="#prerequisites"><span class="octicon octicon-link"></span></a>Prerequisites</h3>

<p>为了通过路由器使用宽带，您需要：</p>

<ol>
<li>1台已安装 OpenWRT 12.09(Attitude Adjustment) 的路由器。</li>
<li>1台已安装天翼校园客户端的计算机</li>
<li>2根以太网电缆</li>
</ol><p>为了完成路由器的安装过程，您需要：</p>

<ol>
<li>1台运行 Linux 并可访问互联网的计算机</li>
<li>知道您的路由器的 CPU 体系</li>
<li>熟悉 vim, ssh, make 的使用</li>
</ol><h3>
<a name="compile" class="anchor" href="#compile"><span class="octicon octicon-link"></span></a>Compile</h3>

<h4>
<a name="%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91%E4%BE%9D%E8%B5%96" class="anchor" href="#%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91%E4%BE%9D%E8%B5%96"><span class="octicon octicon-link"></span></a>安装编译依赖</h4>

<p>参见 <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence">http://wiki.openwrt.org/doc/howto/buildroot.exigence</a></p>

<h4>
<a name="%E8%8E%B7%E5%BE%97%E6%BA%90%E4%BB%A3%E7%A0%81" class="anchor" href="#%E8%8E%B7%E5%BE%97%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="octicon octicon-link"></span></a>获得源代码</h4>

<pre><code>git clone https://github.com/BillLeecn/openwrt-esurfix.git openwrt-esurfix
cd  openwrt-esurfix
git checkout integrate-chap-proxy
</code></pre>

<h4>
<a name="%E8%8E%B7%E5%BE%97%E5%88%9D%E5%A7%8B%E9%85%8D%E7%BD%AE" class="anchor" href="#%E8%8E%B7%E5%BE%97%E5%88%9D%E5%A7%8B%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>获得初始配置</h4>

<p>在 <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/">OpenWRT 12.09 下载页</a>
找到您的路由器对应的 CPU 体系，访问其中的 generic/ 目录，下载 config.CPU体系_generic, 保存为 .config</p>

<h4>
<a name="%E7%BC%96%E8%AF%91" class="anchor" href="#%E7%BC%96%E8%AF%91"><span class="octicon octicon-link"></span></a>编译</h4>

<pre><code>make defconfig
make download
make
</code></pre>

<h3>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h3>

<h4>
<a name="%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="anchor" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="octicon octicon-link"></span></a>安装软件包</h4>

<pre><code>scp bin/您的CPU体系/packages/rp-pppoe-server_*.ipk root@192.168.1.1:/tmp
scp bin/您的CPU体系/packages/ppp_*.ipk root@192.168.1.1:/tmp
scp bin/您的CPU体系/packages/chap-proxy_*.ipk root@192.168.1.1:/tmp
ssh root@192.168.1.1
opkg install /tmp/rp-pppoe-server_*.ipk
opkg install /tmp/ppp_*.ipk
opkg install /tmp/chap-proxy_*.ipk
</code></pre>

<h4>
<a name="%E9%85%8D%E7%BD%AE-pppoe-server" class="anchor" href="#%E9%85%8D%E7%BD%AE-pppoe-server"><span class="octicon octicon-link"></span></a>配置 pppoe-server</h4>

<p><em>如果您的路由器 LAN 口的名字是 br-lan, 那么您不需要执行本步骤。</em></p>

<pre><code>vim /etc/default/pppoe-server
</code></pre>

<p>将 OPTIONS="-k -C MyRouter -I br-lan" 改成 OPTIONS="-k -C MyRouter -I 您的路由器的LAN口".</p>

<h4>
<a name="%E9%85%8D%E7%BD%AE-chap-proxy" class="anchor" href="#%E9%85%8D%E7%BD%AE-chap-proxy"><span class="octicon octicon-link"></span></a>配置 chap-proxy</h4>

<pre><code>vim /etc/config/network
</code></pre>

<p>找到 config interface 'wan' 一节按如下方式设置：</p>

<pre><code>config interface 'wan'
    option proto 'pppoe'
    option username '^#01宽带帐号'
    option password 'stub'
    option auto '0'
</code></pre>

<h4>
<a name="%E6%9C%80%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE" class="anchor" href="#%E6%9C%80%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>最后的配置</h4>

<p>启用 pppoe-server 与 chap-proxy</p>

<pre><code>/etc/init.d/pppoe-server enable
/etc/init.d/chap-proxy enable
</code></pre>

<p>重启路由器</p>

<pre><code>reboot
</code></pre>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<h4>
<a name="%E8%BF%9E%E7%BA%BF" class="anchor" href="#%E8%BF%9E%E7%BA%BF"><span class="octicon octicon-link"></span></a>连线</h4>

<p>将 WAN 口连接到宽带端口，LAN 口连接到已安装天翼客户端的机器</p>

<h4>
<a name="%E8%BF%9E%E6%8E%A5" class="anchor" href="#%E8%BF%9E%E6%8E%A5"><span class="octicon octicon-link"></span></a>连接</h4>

<p>直接使用天翼客户端进行有线连接，天翼客户端会提示用户名密码错误，请自行判断连接是否成功。</p>

<p>如果您的计算机和路由器支持 WLAN, 在连接成功后，您可以断开计算机与路由器连接的以太网电缆，改用 WLAN.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">OpenWRT-eSurfix maintained by <a href="https://github.com/BillLeecn">BillLeecn</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-50454805-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
